{{define "portfolio_empty"}}
<div class="bg-white rounded-lg shadow-lg p-8 text-center">
    <div class="mb-6">
        <svg class="w-24 h-24 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
    </div>
    
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Voc√™ ainda n√£o tem um portf√≥lio</h2>
    <p class="text-gray-600 mb-6">Crie seu portf√≥lio profissional e destaque suas habilidades, experi√™ncias e projetos.</p>
    
    <button onclick="showCreateForm()" 
            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors text-lg">
        üöÄ Criar Meu Portf√≥lio
    </button>
</div>

<!-- Formul√°rio de Cria√ß√£o (inicialmente oculto) -->
<div id="create-form" class="hidden mt-6">
    <form hx-post="/portfolio/create/html" 
          hx-target="#portfolio-container"
          hx-swap="innerHTML"
          hx-ext="json-enc"
          class="space-y-6">
        
        <!-- Informa√ß√µes B√°sicas -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üìù Informa√ß√µes B√°sicas</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">T√≠tulo Profissional *</label>
                    <input type="text" name="headline" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Ex: Desenvolvedor Full Stack">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
                    <textarea name="bio" rows="3"
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="Conte um pouco sobre voc√™ e sua trajet√≥ria profissional..."></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Senioridade</label>
                    <select name="seniority" 
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="JUNIOR">J√∫nior</option>
                        <option value="MID_LEVEL">Pleno</option>
                        <option value="SENIOR">S√™nior</option>
                        <option value="LEAD">Tech Lead</option>
                        <option value="PRINCIPAL">Principal</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Anos de Experi√™ncia</label>
                    <input type="number" name="years_of_experience" value="0" min="0"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="open_to_work" id="create_open_to_work"
                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="create_open_to_work" class="text-sm font-medium text-gray-700">Aberto a propostas</label>
                </div>
            </div>
        </div>

        <!-- Prefer√™ncias de Trabalho -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üí∞ Prefer√™ncias de Trabalho</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Expectativa Salarial</label>
                    <input type="number" name="salary_expectation" step="100" value="0"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Moeda</label>
                    <select name="currency"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="BRL">BRL (R$)</option>
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (‚Ç¨)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Contrato</label>
                    <input type="text" name="contract_type"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="CLT, PJ, Freelance...">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Modalidade</label>
                    <select name="location"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="REMOTE">Remoto</option>
                        <option value="ON_SITE">Presencial</option>
                        <option value="HYBRID">H√≠brido</option>
                        <option value="ANY">Qualquer</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="remote_only" id="create_remote_only"
                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="create_remote_only" class="text-sm font-medium text-gray-700">Apenas remoto</label>
                </div>
            </div>
        </div>

        <!-- Social Links -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üîó Links Sociais</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                    <input type="url" name="social_links.linkedin"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="https://linkedin.com/in/...">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">GitHub</label>
                    <input type="url" name="social_links.github"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="https://github.com/...">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                    <input type="url" name="social_links.website"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="https://...">
                </div>
            </div>
        </div>

        <!-- Skills -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üõ†Ô∏è Habilidades</h3>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Skills (separadas por v√≠rgula)</label>
                <input type="text" id="create-skills-input"
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="JavaScript, TypeScript, Go, React, Node.js...">
            </div>
        </div>

        <!-- Experi√™ncias -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üíº Experi√™ncias</h3>
            <div id="create-experiences-container" class="space-y-4">
            </div>
            <button type="button" onclick="addCreateExperience()" 
                    class="mt-4 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200">
                + Adicionar Experi√™ncia
            </button>
        </div>

        <!-- Projetos -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üöÄ Projetos</h3>
            <div id="create-projects-container" class="space-y-4">
            </div>
            <button type="button" onclick="addCreateProject()" 
                    class="mt-4 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200">
                + Adicionar Projeto
            </button>
        </div>

        <!-- Forma√ß√£o -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üéì Forma√ß√£o Acad√™mica</h3>
            <div id="create-educations-container" class="space-y-4">
            </div>
            <button type="button" onclick="addCreateEducation()" 
                    class="mt-4 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200">
                + Adicionar Forma√ß√£o
            </button>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="flex gap-4">
            <button type="button" onclick="hideCreateForm()" 
                    class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                Cancelar
            </button>
            <button type="submit" onclick="prepareCreateFormData(event)"
                    class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                üöÄ Criar Portf√≥lio
            </button>
        </div>
    </form>
</div>

<script>
function showCreateForm() {
    document.getElementById('create-form').classList.remove('hidden');
}

function hideCreateForm() {
    document.getElementById('create-form').classList.add('hidden');
}

function removeCreateItem(button, type) {
    button.closest(`.create-${type}-item`).remove();
}

function addCreateExperience() {
    const container = document.getElementById('create-experiences-container');
    const html = `
        <div class="create-experience-item border border-gray-200 rounded-lg p-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
                    <input type="text" data-field="company" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cargo</label>
                    <input type="text" data-field="role" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data In√≠cio</label>
                    <input type="date" data-field="startDate" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data Fim</label>
                    <input type="date" data-field="endDate" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                    <textarea data-field="description" rows="2" class="w-full p-2 border border-gray-300 rounded-lg"></textarea>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tech Stack (separado por v√≠rgula)</label>
                    <input type="text" data-field="techStack" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            <button type="button" onclick="removeCreateItem(this, 'experience')" class="mt-2 text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Remover</button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
}

function addCreateProject() {
    const container = document.getElementById('create-projects-container');
    const html = `
        <div class="create-project-item border border-gray-200 rounded-lg p-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                    <input type="text" data-field="name" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tags (separadas por v√≠rgula)</label>
                    <input type="text" data-field="tags" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                    <textarea data-field="description" rows="2" class="w-full p-2 border border-gray-300 rounded-lg"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">URL do Reposit√≥rio</label>
                    <input type="url" data-field="repoUrl" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">URL Demo</label>
                    <input type="url" data-field="liveUrl" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            <button type="button" onclick="removeCreateItem(this, 'project')" class="mt-2 text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Remover</button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
}

function addCreateEducation() {
    const container = document.getElementById('create-educations-container');
    const html = `
        <div class="create-education-item border border-gray-200 rounded-lg p-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Institui√ß√£o</label>
                    <input type="text" data-field="institution" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Grau</label>
                    <input type="text" data-field="degree" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Bacharelado, Mestrado...">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">√Årea</label>
                    <input type="text" data-field="field" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data In√≠cio</label>
                    <input type="date" data-field="startDate" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data Fim</label>
                    <input type="date" data-field="endDate" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            <button type="button" onclick="removeCreateItem(this, 'education')" class="mt-2 text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Remover</button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
}

function prepareCreateFormData(event) {
    event.preventDefault();
    const form = event.target.closest('form');
    
    const data = {
        headline: form.querySelector('[name="headline"]').value,
        bio: form.querySelector('[name="bio"]').value,
        seniority: form.querySelector('[name="seniority"]').value,
        years_of_experience: parseInt(form.querySelector('[name="years_of_experience"]').value) || 0,
        open_to_work: form.querySelector('[name="open_to_work"]').checked,
        salary_expectation: parseFloat(form.querySelector('[name="salary_expectation"]').value) || 0,
        currency: form.querySelector('[name="currency"]').value,
        contract_type: form.querySelector('[name="contract_type"]').value,
        location: form.querySelector('[name="location"]').value,
        remote_only: form.querySelector('[name="remote_only"]').checked,
        skills: document.getElementById('create-skills-input').value.split(',').map(s => s.trim()).filter(s => s),
        social_links: {
            linkedin: form.querySelector('[name="social_links.linkedin"]').value,
            github: form.querySelector('[name="social_links.github"]').value,
            website: form.querySelector('[name="social_links.website"]').value
        },
        experiences: [],
        projects: [],
        educations: []
    };

    // Collect experiences
    document.querySelectorAll('.create-experience-item').forEach(item => {
        const exp = {
            company: item.querySelector('[data-field="company"]').value,
            role: item.querySelector('[data-field="role"]').value,
            startDate: item.querySelector('[data-field="startDate"]').value ? new Date(item.querySelector('[data-field="startDate"]').value).toISOString() : null,
            endDate: item.querySelector('[data-field="endDate"]').value ? new Date(item.querySelector('[data-field="endDate"]').value).toISOString() : null,
            description: item.querySelector('[data-field="description"]').value,
            techStack: item.querySelector('[data-field="techStack"]').value.split(',').map(s => s.trim()).filter(s => s)
        };
        if (exp.company || exp.role) data.experiences.push(exp);
    });

    // Collect projects
    document.querySelectorAll('.create-project-item').forEach(item => {
        const proj = {
            name: item.querySelector('[data-field="name"]').value,
            description: item.querySelector('[data-field="description"]').value,
            repoUrl: item.querySelector('[data-field="repoUrl"]').value,
            liveUrl: item.querySelector('[data-field="liveUrl"]').value,
            tags: item.querySelector('[data-field="tags"]').value.split(',').map(s => s.trim()).filter(s => s)
        };
        if (proj.name) data.projects.push(proj);
    });

    // Collect educations
    document.querySelectorAll('.create-education-item').forEach(item => {
        const edu = {
            institution: item.querySelector('[data-field="institution"]').value,
            degree: item.querySelector('[data-field="degree"]').value,
            field: item.querySelector('[data-field="field"]').value,
            startDate: item.querySelector('[data-field="startDate"]').value ? new Date(item.querySelector('[data-field="startDate"]').value).toISOString() : null,
            endDate: item.querySelector('[data-field="endDate"]').value ? new Date(item.querySelector('[data-field="endDate"]').value).toISOString() : null
        };
        if (edu.institution) data.educations.push(edu);
    });

    // Send via fetch with JSON
    fetch('/portfolio/html', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.text())
    .then(html => {
        document.getElementById('portfolio-container').innerHTML = html;
        // Re-execute scripts in the new HTML
        const scripts = document.getElementById('portfolio-container').querySelectorAll('script');
        scripts.forEach(script => {
            const newScript = document.createElement('script');
            newScript.textContent = script.textContent;
            document.body.appendChild(newScript);
            document.body.removeChild(newScript);
        });
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Erro ao criar portf√≥lio');
    });
}
</script>
{{end}}
